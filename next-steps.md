# src-check プロジェクト: 次のステップ

## プロジェクト現状分析

### 完了済みの作業
1. **基本構造の構築**
   - プロジェクトディレクトリ構造が整備済み
   - pyproject.tomlによるパッケージ設定完了
   - 2つのCLIエントリーポイント（src-check、src-check-kpi）実装
   - 開発ツール設定（Black、Ruff、mypy、pytest）

2. **ドキュメント整備**
   - README.md（基本的な使用方法）
   - requirements-specification.md（詳細な要件定義 - 静的解析へ更新済み）
   - security-migration-plan.md（セキュリティ移行計画）
   - security-checklist.md（セキュリティチェックリスト）

3. **初期実装**
   - CLIの引数解析とパス検証機能
   - プレースホルダーのKPIスコア表示
   - 基本的なエラーハンドリング

### 未実装の主要機能
1. **コア機能**
   - プラグインレジストリシステム
   - 実際の品質チェッカー（20+種類）
   - KPIスコアリングエンジン
   - 自動修正機能

2. **データモデル**
   - CheckResult、KPIScore、FailureLocationなどのモデル定義
   - 結果の永続化とレポート生成

3. **プロセッサー**
   - 品質ルールの実装
   - インポート管理システム
   - 自動修正エンジン

## 優先度別の次のステップ

### 優先度1: コアデータモデルの実装（1週間）
```
src_check/models/
├── __init__.py
├── check_result.py     # CheckResult, FailureLocation
├── kpi_score.py        # KPIScore, CategoryScore
└── config.py           # Configuration models
```

**実装内容:**
- CheckResult: タイトル、失敗箇所、修正ポリシー、修正例
- KPIScore: 4軸評価（コード品質、アーキテクチャ、テスト、セキュリティ）
- Config: YAML/JSON設定の読み込みと検証

### 優先度2: 基本的な品質チェッカーの実装（2週間）
```
src_check/rules/
├── __init__.py
├── security.py         # SecurityCheckerクラス
├── code_quality.py     # CodeQualityCheckerクラス
├── architecture.py     # ArchitectureCheckerクラス
└── test_quality.py     # TestQualityCheckerクラス
```

**実装内容:**
- 各チェッカーはBaseCheckerを継承
- ASTベースの静的解析のみ
- CheckResultを返す統一インターフェース
- エントリーポイントによる登録

### 優先度3: プラグインレジストリシステム（1週間）
```
src_check/core/
├── __init__.py
├── base.py              # BaseChecker基底クラス
├── registry.py          # プラグインレジストリ
└── ast_analyzer.py      # AST解析エンジン
```

**実装内容:**
- setuptoolsのエントリーポイントを使用
- プラグインの動的登録と検証
- ASTキャッシュによるパフォーマンス最適化

### 優先度4: KPIスコアリングエンジン（1週間）
```
src_check/core/scoring/
├── __init__.py
├── calculator.py        # スコア計算ロジック
├── aggregator.py        # 結果の集約
└── reporter.py          # レポート生成
```

**実装内容:**
- 重み付け可能な4軸評価
- 0-100点のスコア計算
- テキスト/JSON/Markdown形式のレポート

### 優先度5: 自動修正機能（2週間）
```
src_check/processors/auto_correct/
├── __init__.py
├── import_fixer.py      # インポート修正
├── code_formatter.py    # コード整形
└── cleaner.py          # 不要ファイル削除
```

**実装内容:**
- ASTを使用した安全な修正
- インポートパスの自動修正
- 空フォルダ・不要ファイルの削除

## 開発推奨事項

### 1. セキュリティ優先の開発
- 静的解析のみ（コード実行なし）
- エントリーポイントによる明示的なプラグイン管理
- パストラバーサル防止と入力検証

### 2. テスト駆動開発
- 各モジュールに対応するテストを先に作成
- pytest-covでカバレッジ80%以上を維持
- モックを活用した単体テストの充実

### 3. 段階的リリース
- v0.1.0: 静的解析ベースの基本チェッカー（4種類）
- v0.2.0: KPIスコアリング機能
- v0.3.0: プラグインシステムと外部プラグイン対応
- v0.4.0: 自動修正機能
- v1.0.0: 全機能実装とセキュリティ強化

### 4. CI/CD設定
- GitHub Actionsによる自動テスト
- セキュリティスキャン（Bandit、Safety）
- pre-commitフックの設定
- 自動リリースワークフロー

### 5. ドキュメント整備
- Sphinx/MkDocsによるAPI文書
- 使用例とベストプラクティス
- プラグイン開発ガイド
- セキュリティポリシー文書

## 技術的考慮事項

### セキュリティ実装
- 静的AST解析のみ（コード実行なし）
- ファイルサイズ制限（10MB）
- パストラバーサル防止
- プラグイン検証機能

### パフォーマンス最適化
- ASTキャッシュによる高速化
- マルチプロセッシングによる並列実行
- 大規模プロジェクト対応

### エラーハンドリング
- graceful degradationの実装
- 詳細なエラーメッセージ
- リカバリー機能

### 拡張性
- エントリーポイントベースのプラグインシステム
- カスタムルールの安全な追加
- 外部ツールとの連携

## まとめ

src-checkプロジェクトは基本的な骨組みが完成し、セキュリティ要件も明確になりました。動的インポートから静的解析への移行により、pipパッケージとして安全に配布できる設計となっています。

優先度に従って段階的に開発を進めることで、早期に使用可能なバージョンをリリースし、フィードバックを得ながら改善していくことが推奨されます。

特に重要なのは：
1. **セキュリティ優先の設計**（pipパッケージとしての信頼性）
2. **静的解析の徹底**（コード実行リスクの排除）
3. **テストの充実**（品質保証ツールとしての信頼性）
4. **パフォーマンスの考慮**（実用性の確保）

これらを念頭に置きながら、アジャイルな開発プロセスで進めていくことが成功への鍵となるでしょう。