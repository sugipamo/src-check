# src-check フィードバック対応改善計画

## 📋 概要
**作成日**: 2025-07-04 09:30
**対象**: src-check v0.3.0
**目的**: ユーザーフィードバックに基づく文脈認識機能と品質改善

## 🔍 フィードバック分析

### ✅ 正当な指摘（継続対応）
- print文 → logging への移行
- 型ヒントの充実
- 複雑な関数のリファクタリング
- パフォーマンス最適化
- ドキュメントの充実
- テストカバレッジの向上

### ⚠️ 疑問視された指摘（改善対象）
- 例示ファイルでの高結合度指摘
- デモコードでのprint文指摘
- 著作権ヘッダー必須判定
- 関数内import文の一律否定

## 🎯 改善計画

### 1. 文脈認識機能の実装
**目標**: ファイル種別を判定し、適切なルールを適用

#### 1.1 ファイル分類システム
```python
class FileContextAnalyzer:
    def classify_file(self, file_path: str) -> FileType:
        """ファイルの種別を判定"""
        # 例示コード判定
        if any(pattern in file_path for pattern in [
            'example', 'demo', 'sample', 'tutorial',
            'test', 'spec', '__pycache__'
        ]):
            return FileType.EXAMPLE
        
        # 設定ファイル判定
        if file_path.endswith(('.py', '.toml', '.yaml', '.json')):
            return FileType.CONFIG
        
        # 本番コード判定
        return FileType.PRODUCTION
```

#### 1.2 ルール適用の調整
- **例示コード**: print文許可、結合度チェック緩和
- **本番コード**: 厳格なルール適用
- **設定ファイル**: 特殊ルールセット

### 2. 閾値カスタマイズ機能
**目標**: プロジェクト特性に応じた設定可能

#### 2.1 設定ファイル拡張
```yaml
# .src-check.yaml
thresholds:
  complexity:
    cyclomatic: 10  # デフォルト: 10
    cognitive: 15   # デフォルト: 15
  coupling:
    max_dependencies: 20  # デフォルト: 10
    max_imports: 15       # デフォルト: 10
  
file_types:
  example_patterns:
    - "**/example/**"
    - "**/demo/**"
    - "**/sample/**"
  
rules:
  print_statements:
    severity: error      # production
    example_severity: warning  # example files
  
  copyright_header:
    required: false      # project policy
    patterns: []
```

#### 2.2 重大度レベル調整
- **Critical**: セキュリティ脆弱性、実行時エラー
- **High**: 型安全性、パフォーマンス重大問題
- **Medium**: コード品質、保守性
- **Low**: スタイル、軽微な改善提案
- **Info**: 情報提供、ベストプラクティス

### 3. ルール説明機能の充実
**目標**: 各ルールの重要性と修正方法を明確化

#### 3.1 説明情報の構造化
```python
class RuleDocumentation:
    def __init__(self, rule_id: str):
        self.rule_id = rule_id
        self.importance = self._get_importance()
        self.fix_suggestion = self._get_fix_suggestion()
        self.best_practice = self._get_best_practice()
        self.context_notes = self._get_context_notes()
```

#### 3.2 出力形式の改善
```
❌ [HIGH] Print statement found (line 42)
📋 Why: Print statements in production code can cause issues with logging systems
🔧 Fix: Replace with logging.info() or logging.debug()
💡 Best Practice: Use structured logging for better observability
ℹ️  Context: This rule is relaxed for example/demo files
```

### 4. デモコード対応機能
**目標**: 例示コードでの特殊ルール適用

#### 4.1 例示コード専用ルールセット
- Print文: 警告レベルに軽減
- 結合度: 閾値を2倍に調整
- 著作権ヘッダー: 要求しない
- 関数内import: 教育目的で許可

#### 4.2 プロジェクト方針対応
- 組織固有の設定テンプレート
- プロジェクト初期化時の設定ガイド
- 業界標準との整合性確保

## 📅 実装スケジュール

### Phase 1: 文脈認識基盤（2週間）
- [ ] FileContextAnalyzer実装
- [ ] ファイル分類ロジック
- [ ] 基本テストケース作成

### Phase 2: 閾値カスタマイズ（2週間）
- [ ] 設定ファイル拡張
- [ ] 動的閾値適用システム
- [ ] 重大度レベル調整機能

### Phase 3: ルール説明機能（1週間）
- [ ] RuleDocumentation実装
- [ ] 説明情報データベース作成
- [ ] 出力フォーマット改善

### Phase 4: デモコード対応（1週間）
- [ ] 例示コード専用ルールセット
- [ ] プロジェクト方針設定機能
- [ ] 統合テスト実施

## 🧪 テスト計画

### 単体テスト
- FileContextAnalyzer各メソッド
- 閾値設定読み込み機能
- ルール適用ロジック

### 統合テスト
- 実際のプロジェクトでの検証
- 例示コードでの動作確認
- 設定ファイルでの動作確認

### 品質保証
- 既存テストの回帰テスト
- パフォーマンステスト
- ドキュメント整備

## 📊 成功指標

### 定量的指標
- 誤検出率: 30%削減
- ユーザー満足度: 4.0/5.0以上
- 設定カスタマイズ率: 50%以上

### 定性的指標
- フィードバックの質的改善
- 例示コードでの適切な動作
- プロジェクト方針への適応性

## 🔧 技術仕様

### 新規モジュール
- `src_check/context/` - 文脈認識機能
- `src_check/config/` - 設定管理機能拡張
- `src_check/docs/` - ルール説明機能

### 既存モジュール修正
- `src_check/rules/` - ルール適用ロジック調整
- `src_check/core/` - エンジン部分の機能拡張
- `src_check/formatters/` - 出力フォーマット改善

## 🚀 v0.3.0 リリース目標

**リリース予定**: 2025-08-01
**主要機能**: 文脈認識型品質チェック
**品質目標**: 
- テストカバレッジ 85%以上維持
- 誤検出率 30%削減
- 設定カスタマイズ性の大幅向上

---

**更新日**: 2025-07-04 09:30
**作成者**: Claude Code
**承認**: 待機中