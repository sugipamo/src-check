# 文脈認識機能実装とv0.3.0開発開始計画

## 作成日時
2025-07-04 13:30

## 背景と目的
v0.2.0の技術的実装は完了し、TestPyPI/PyPI公開を待つ段階です。
ユーザーフィードバックに基づく文脈認識機能の実装を中心に、v0.3.0の開発を開始します。

## 現在の状況
- ✅ v0.2.0技術的実装完了（全182テスト合格、カバレッジ86.51%）
- ⏳ TestPyPI/PyPI公開待ち（APIトークン設定必要）
- ✅ フィードバック対応計画書作成済み（202507040930）
- ✅ 環境問題解決済み（Python 3.12-venv、仮想環境クリーンアップ）

## 主要目標
1. **文脈認識機能の実装** - ファイル種別判定による適切なルール適用
2. **閾値カスタマイズ機能** - プロジェクト特性に応じた設定
3. **ルール説明機能の充実** - 各ルールの重要性と修正方法の明確化

## 実行計画

### フェーズ1: 設計と準備（1週間）

#### 1.1 文脈認識機能の詳細設計
- [ ] FileContextAnalyzerクラスの設計
  - ファイル種別判定ロジック（本番/例示/設定）
  - パス解析とパターンマッチング
  - 拡張可能な分類システム

- [ ] ルール適用エンジンの改修設計
  - コンテキスト別ルールセット
  - 動的ルール調整メカニズム
  - 既存チェッカーへの影響分析

#### 1.2 設定ファイルスキーマ拡張
- [ ] .src-check.yamlの新フォーマット設計
  ```yaml
  file_context:
    example_patterns:
      - "**/example/**"
      - "**/demo/**"
      - "**/sample/**"
    
  thresholds:
    complexity:
      cyclomatic: 10
      cognitive: 15
    coupling:
      max_dependencies: 20
      max_imports: 15
  
  rules:
    print_statements:
      production_severity: error
      example_severity: warning
  ```

- [ ] 設定バリデーションロジック設計
- [ ] 後方互換性の確保

#### 1.3 開発環境準備
- [ ] feature/v0.3.0-context-awareブランチ作成
- [ ] 開発用テストケースセット準備
- [ ] パフォーマンスベンチマーク基準値設定

### フェーズ2: コア実装（2週間）

#### 2.1 FileContextAnalyzer実装
- [ ] 基本クラス実装
  ```python
  class FileContextAnalyzer:
      def __init__(self, config: SrcCheckConfig):
          self.config = config
          self.patterns = self._compile_patterns()
      
      def classify_file(self, file_path: Path) -> FileType:
          """ファイルの種別を判定"""
          pass
      
      def get_context_rules(self, file_type: FileType) -> RuleSet:
          """ファイル種別に応じたルールセットを返す"""
          pass
  ```

- [ ] ファイル分類ロジック実装
- [ ] テストケース作成（単体テスト）

#### 2.2 ルール適用エンジン改修
- [ ] AnalysisEngineの拡張
  - FileContextAnalyzerの統合
  - コンテキスト別ルール適用
  - 既存処理への影響最小化

- [ ] 各チェッカーのコンテキスト対応
  - SecurityChecker: 例示コードでの緩和
  - CodeQualityChecker: print文ルールの調整
  - ArchitectureChecker: 結合度閾値の動的調整

#### 2.3 設定管理機能拡張
- [ ] ConfigLoaderの機能拡張
  - 新スキーマの読み込み
  - デフォルト値の管理
  - マイグレーション機能

- [ ] 設定検証機能の実装
- [ ] エラーメッセージの改善

### フェーズ3: ルール説明機能（1週間）

#### 3.1 RuleDocumentationシステム
- [ ] ルール説明データベース構築
  ```python
  class RuleDocumentation:
      rules = {
          "SEC001": {
              "name": "Hardcoded Password",
              "importance": "Critical security vulnerability",
              "fix": "Use environment variables or secure credential storage",
              "best_practice": "Implement proper secret management",
              "context_notes": "Less critical in example code"
          }
      }
  ```

- [ ] 多言語対応準備（初期は英語のみ）

#### 3.2 出力フォーマット改善
- [ ] TextFormatterの拡張
  - ルール説明の表示
  - コンテキスト情報の表示
  - より詳細な修正提案

- [ ] MarkdownFormatterの改善
- [ ] JSONフォーマットへの説明追加

### フェーズ4: テストと品質保証（1週間）

#### 4.1 包括的テスト実施
- [ ] 単体テスト追加（目標: カバレッジ90%以上）
- [ ] 統合テスト実施
  - 実プロジェクトでの検証
  - 例示コードでの動作確認
  - パフォーマンステスト

#### 4.2 ドキュメント作成
- [ ] 文脈認識機能ガイド
- [ ] 設定ファイルリファレンス
- [ ] マイグレーションガイド（v0.2.0→v0.3.0）

#### 4.3 品質チェック
- [ ] ruffエラー解決（現在16件）
- [ ] mypyエラー0件維持
- [ ] Blackフォーマット適用

### フェーズ5: リリース準備（3日間）

#### 5.1 バージョン更新
- [ ] __version__ = "0.3.0"への更新
- [ ] CHANGELOGの更新
- [ ] リリースノート作成

#### 5.2 最終テスト
- [ ] 全テストスイート実行
- [ ] 手動テスト実施
- [ ] ベンチマーク確認

## 成功指標

### 技術指標
- テストカバレッジ: 90%以上
- パフォーマンス: 現状維持（10,000行/秒以上）
- 誤検出率: 30%削減

### 品質指標
- 全テスト合格（200+テスト予定）
- mypyエラー: 0件
- ruffエラー: 5件以下

### ユーザビリティ指標
- 設定の柔軟性向上
- エラーメッセージの改善
- ドキュメントの充実

## リスクと対策

### リスク
1. **既存機能への影響**
   - 対策: 包括的なレグレッションテスト
   - 対策: 段階的な機能追加

2. **パフォーマンス低下**
   - 対策: プロファイリングの継続実施
   - 対策: キャッシュ機能の検討

3. **設定の複雑化**
   - 対策: デフォルト値の適切な設定
   - 対策: 設定例の充実

## 次のステップ

### 即時アクション（TestPyPI公開後）
1. feature/v0.3.0-context-awareブランチ作成
2. FileContextAnalyzerの基本実装開始
3. テストケースの準備

### 1週間以内
1. 詳細設計完了
2. コア実装開始
3. 週次進捗レポート作成

### 2週間以内
1. 基本機能実装完了
2. テスト実施
3. ドキュメント作成開始

## 備考
- v0.2.0のフィードバックを積極的に収集し反映
- パフォーマンスを常に監視
- 後方互換性を最大限維持
- コミュニティからの貢献を歓迎

---

**作成者**: Claude Code  
**承認**: 待機中  
**関連文書**: 
- 202507040930_フィードバック対応_文脈認識機能改善計画.md
- 202507031720_計画_v0.2.0リリースとv0.3.0開発準備.md