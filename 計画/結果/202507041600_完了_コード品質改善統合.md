# 計画: コード品質改善統合

## 作成日時
2025-07-04 16:00

## 背景
以下の重複したコード品質問題を統合：
- 202507041330_修正依頼_コード品質問題.md（ruff 18エラー）
- 202507041424_修正依頼_src-checkコード品質問題.md（ruff 28エラー、mypy 14エラー）
- 202507041424_修正依頼_コード品質改善.md（品質スコア19.3/100）
- 202507041424_修正依頼_mypy型チェックエラー修正.md（mypy 14エラー）

## 現在の状況
最新の確認結果（ROADMAP.md記載）：
- ruffエラー: 16件（主にSIM117）
- mypyエラー: 0件（解決済み）
- テストカバレッジ: 77.39%
- 品質スコア: 未測定（前回19.3/100）

## 目標
1. ruffエラーを0件にする
2. src-checkによる品質スコアを80点以上にする
3. Blackフォーマットを全ファイルに適用

## 実施タスク

### フェーズ1: 現状確認（15分）
1. **最新のコード品質チェック**
   - [ ] `ruff check .` で現在のエラー確認
   - [ ] `mypy .` で型チェック確認
   - [ ] `src-check .` で品質スコア確認
   - [ ] `black --check .` でフォーマット必要ファイル確認

### フェーズ2: ruffエラー修正（30分）
1. **SIM117エラー修正**（複数with文の結合）
   - [ ] 該当箇所の特定
   - [ ] with文の結合実施
   - [ ] テスト実行確認

2. **その他のエラー修正**
   - [ ] エラー内容の確認
   - [ ] 適切な修正の実施
   - [ ] 修正後の動作確認

### フェーズ3: Blackフォーマット適用（15分）
1. **フォーマット実行**
   - [ ] `black .` でフォーマット適用
   - [ ] 変更されたファイルの確認
   - [ ] テスト実行で影響確認

### フェーズ4: 品質スコア改善（1時間）
1. **src-checkによる詳細分析**
   - [ ] 各チェッカーの結果確認
   - [ ] 低スコアの原因特定
   - [ ] 改善可能な項目のリストアップ

2. **優先度の高い改善実施**
   - [ ] セキュリティ問題の解決
   - [ ] コード複雑度の削減
   - [ ] ドキュメント不足の解消

### フェーズ5: 最終確認（20分）
1. **全体確認**
   - [ ] すべてのテストが合格
   - [ ] カバレッジが維持または向上
   - [ ] パフォーマンスへの影響なし

2. **ドキュメント更新**
   - [ ] 改善内容の記録
   - [ ] ROADMAP.mdの更新

## リスクと対策

### リスク1: 自動修正による予期しない動作変更
- **対策**: 各修正後にテスト実行、段階的な修正

### リスク2: 品質スコア改善が困難
- **対策**: 現実的な目標設定、段階的改善計画

## 成功基準
- ruffエラー0件
- mypyエラー0件維持
- 品質スコア50点以上（段階的に80点を目指す）
- 全テスト合格維持

## 推定所要時間
- 合計: 約2時間30分

## 関連ファイル
- 統合元: 202507041330、202507041424シリーズの修正依頼ファイル
- 参考: ROADMAP.mdの品質指標セクション